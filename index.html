<html>
    <style>
        table {
          font-family: monospace;
          border-collapse: collapse;
          width: 100%;
        }
        
        td, th {
          border: 1px solid #dddddd;
          text-align: left;
          padding: 8px;
        }
        
        tr:nth-child(even) {
          background-color: #dddddd;
        }
        body {margin:0;}
        .navbar {
          overflow: hidden;
          position: fixed;
          top: 0;
          width: 100%;
          border-style: solid;
          background-color: white;
          padding: 16px;
        }




        .main {
          padding: 16px;
          margin-top: 120px;
          height: 1500px; /* Used in this example to enable scrolling */
        }
        </style>
    <script>
        var x;
        var startstop = 0;

        var columns = 5
var rows = 4;

function radioClick(radio_num){
  for (let i = 0; i < ((rows-1)*2); i++) {
    if (document.getElementById("radio_" + i.toString()).checked === true){
       document.getElementById("radio_" + i.toString()).checked = false;
                    
    }
}
  document.getElementById("radio_" + radio_num.toString()).checked = true;         


}

function addColumn() {
	var row_list = [];
  	for (let i = 0; i < rows; i++) {
  		row_list[i] = document.getElementById("myTable").rows[i];
    	var x = row_list[i].insertCell((columns-2));
  		x.innerHTML = "<form><input type=\"text\" value=\"\"></form>";
    }
  columns = columns + 1;
}
function addRow() {
  var table = document.getElementById("myTable");
  var row = table.insertRow(-1);
  rows = rows + 1;
    notes_cell = row.insertCell(0);
    notes_cell.innerHTML = "<form><input type=\"text\" value=\"\" id=\"" + (rows-1).toString() +  "_notes\"></form>";
    transcription_cell = row.insertCell(0);
    transcription_cell.innerHTML = "<form><input type=\"text\" value=\"\" id=\"" + (rows-1).toString() +  "_transcription\"></form>";
    translation_cell = row.insertCell(0);
    translation_cell.innerHTML = "<form><input type=\"text\" value=\"\" id=\"" + (rows-1).toString() +  "_translation\"></form>";    
    start_cell = row.insertCell(-1);
    start_cell.innerHTML = "<form><input type=\"radio\" id=\"radio_" + ((rows-2)*2).toString() + "\" onclick=\"radioClick(" + ((rows-2)*2).toString() + ")\"></form><span id=\"" + ((rows-2)*2).toString() + "_hour\">00</span> : <span id=\"" + ((rows-2)*2).toString() + "_min\">00</span> : <span id=\"" + ((rows-2)*2).toString() + "_sec\">00</span> : <span id=\"" + ((rows-2)*2).toString() + "_milisec\">00</span>";
    end_cell = row.insertCell(-1);
    end_cell.innerHTML = "<form><input type=\"radio\" id=\"radio_" + ((rows*2)-3).toString() + "\"  onclick=\"radioClick(" + ((rows*2)-3).toString() + ")\"></form><span id=\"" + ((rows*2)-3).toString() + "_hour\">00</span> : <span id=\"" + ((rows*2)-3).toString() + "_min\">00</span> : <span id=\"" + ((rows*2)-3).toString() + "_sec\">00</span> : <span id=\"" + ((rows*2)-3).toString() + "_milisec\">00</span>";

}

function deleteRow() {
  if (rows > 2){
    document.getElementById("myTable").deleteRow(-1);
    rows = rows - 1;
  }
}

function deleteColumn() {

	var row_list = [];
  	for (let i = 0; i < rows; i++) {
  		row_list[i] = document.getElementById("myTable").rows[i];
    	row_list[i].deleteCell((columns-3));
    }
  
  columns = columns - 1;
}

function createJSON() {
  json_string = '{"rows":[],"translation_lg":"","transcription_lg":"","notes_lg":""}';  
  outJSON = JSON.parse(json_string);
  
  outJSON["translation_lg"] = document.getElementById("translation_lg").value;
    outJSON["transcription_lg"] = document.getElementById("transcription_lg").value;
    outJSON["notes_lg"] = document.getElementById("notes_lg").value;
  for (let i = 1; i < rows; i++) {
    
    outJSON['rows'].push({"translation":"","transcription":"","notes":"","start_time":0,"end_time":0})
    outJSON['rows'][(i-1)].translation = document.getElementById(i.toString() + "_translation").value;
    outJSON['rows'][(i-1)].transcription = document.getElementById(i.toString() + "_transcription").value;
    outJSON['rows'][(i-1)].notes = document.getElementById(i.toString() + "_notes").value;
    start_hour = parseInt(document.getElementById(((i*2)-2).toString() + "_hour").innerHTML);
    start_min = parseInt(document.getElementById(((i*2)-2).toString() + "_min").innerHTML);
    start_sec = parseInt(document.getElementById(((i*2)-2).toString() + "_sec").innerHTML);
    start_milisec = parseInt(document.getElementById(((i*2)-2).toString() + "_milisec").innerHTML);
    end_hour = parseInt(document.getElementById(((i*2)-1).toString() + "_hour").innerHTML);
    end_min = parseInt(document.getElementById(((i*2)-1).toString() + "_min").innerHTML);
    end_sec = parseInt(document.getElementById(((i*2)-1).toString() + "_sec").innerHTML);
    end_milisec = parseInt(document.getElementById(((i*2)-1).toString() + "_milisec").innerHTML);
    outJSON['rows'][(i-1)].start_time = start_milisec + (start_sec * 1000) + (start_min * 60000) + (start_hour * 3600000);
    outJSON['rows'][(i-1)].end_time = end_milisec + (end_sec * 1000) + (end_min * 60000) + (end_hour * 3600000);
  }
}

  function downloadObjectAsJson(exportObj, exportName){
    var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(exportObj));
    var downloadAnchorNode = document.createElement('a');
    downloadAnchorNode.setAttribute("href",     dataStr);
    downloadAnchorNode.setAttribute("download", exportName + ".json");
    document.body.appendChild(downloadAnchorNode); // required for firefox
    downloadAnchorNode.click();
    downloadAnchorNode.remove();
  }

  function exportFiles(){
    createJSON();
    console.log(outJSON)
    downloadObjectAsJson(outJSON,"WebElicit");


  }




        function startStop() { /* Toggle StartStop */

        startstop = startstop + 1;

        if (startstop === 1) {
            start();
            document.getElementById("start").innerHTML = "Stop";
        } else if (startstop === 2) {
            document.getElementById("start").innerHTML = "Start";
            startstop = 0;
            stop();
        }

        }
        

        function start() {
        x = setInterval(timer, 10);
        } /* Start */

        function stop() {
        clearInterval(x);
        } /* Stop */

        var milisec = 0;
        var sec = 0; /* holds incrementing value */
        var min = 0;
        var hour = 0;

        /* Contains and outputs returned value of  function checkTime */

        var miliSecOut = 0;
        var secOut = 0;
        var minOut = 0;
        var hourOut = 0;

        /* Output variable End */

        function assign(){
          var check_id = 0;
            for (let i = 0; i < ((rows-1)*2); i++) {
                
                if (document.getElementById("radio_" + i.toString()).checked === true){
                    document.getElementById(i.toString() + "_milisec").innerHTML = miliSecOut;
                    document.getElementById(i.toString() + "_sec").innerHTML = secOut;
                    document.getElementById(i.toString() + "_min").innerHTML = minOut;
                    document.getElementById(i.toString() + "_hour").innerHTML = hourOut;
                    check_id = i;
                }
              }
            document.getElementById("radio_" + check_id.toString()).checked = false;
            document.getElementById("radio_" + (check_id+1).toString()).checked = true;
        } 
        
             
        
        

        function timer() {
        /* Main Timer */


        miliSecOut = checkTime(milisec);
        secOut = checkTime(sec);
        minOut = checkTime(min);
        hourOut = checkTime(hour);

        milisec = ++milisec;

        if (milisec === 100) {
            milisec = 0;
            sec = ++sec;
        }

        if (sec == 60) {
            min = ++min;
            sec = 0;
        }

        if (min == 60) {
            min = 0;
            hour = ++hour;

        }


        document.getElementById("milisec").innerHTML = miliSecOut;
        document.getElementById("sec").innerHTML = secOut;
        document.getElementById("min").innerHTML = minOut;
        document.getElementById("hour").innerHTML = hourOut;

        }


        /* Adds 0 when value is <10 */


        function checkTime(i) {
        if (i < 10) {
            i = "0" + i;
        }
        return i;
        }

        function reset() {


        /*Reset*/

        milisec = 0;
        sec = 0;
        min = 0
        hour = 0;

        document.getElementById("milisec").innerHTML = "00";
        document.getElementById("sec").innerHTML = "00";
        document.getElementById("min").innerHTML = "00";
        document.getElementById("hour").innerHTML = "00";

        }
    </script>
    <body>
      <div class="navbar">
        <table id="headerTable">
          <tr><td><h1>
        <span id="hour">00</span> :
        <span id="min">00</span> :
        <span id="sec">00</span> :
        <span id="milisec">00</span>
        </h1>
      </td>
      <td>
        <button onclick="startStop()" id="start">Start</button>
        <button onclick="reset()">Reset</button>
        <button onclick="assign()">Assign time</button>
        <p>
        
        
        <button onclick="addRow()">Add Row</button>
        <button onclick="deleteRow()">Delete row</button>
        <button onclick="exportFiles()">Export JSON</button>
      </td>
      </tr>
      </table>
      </p>
    </div>  
    <div class="main">
        <table id="myTable">
          <tr><th>Translation<br><form><input type="text" id="translation_lg" placeholder="ISO 639-3"></form></th>
            <th>Transcription<br><form><input type="text" id="transcription_lg" placeholder="ISO 639-3"></form></th>
            <th>Notes<br><form><input type="text" id="notes_lg" placeholder="ISO 639-3"></form></th>
            <th>Start Time</th>
            <th>End Time</th>
          </tr>  
          <tr>
                <td><form><input type="text" name="Translation" value="" id="1_translation"></form></td>
                <td><form><input type="text" name="Transcription" value="" id="1_transcription"></form></td>
                <td><form><input type="text" name="Notes" value="" id="1_notes"></form></td>
                <td><form><input type="radio" id="radio_0" onclick="radioClick(0)"></form>
                  <span id="0_hour">00</span> :
                  <span id="0_min">00</span> :
                  <span id="0_sec">00</span> :
                  <span id="0_milisec">00</span>
                  </td>
                <td><form><input type="radio" id="radio_1" onclick="radioClick(1)"></form>
                  <span id="1_hour">00</span> :
                  <span id="1_min">00</span> :
                  <span id="1_sec">00</span> :
                  <span id="1_milisec">00</span>
                  </td>
            </tr>
            <tr>
              <td><form><input type="text" name="Translation" value="" id="2_translation"></form></td>
                <td><form><input type="text" name="Transcription" value="" id="2_transcription"></form></td>
                <td><form><input type="text" name="Notes" value="" id="2_notes"></form></td>
              <td><form><input type="radio" id="radio_2" onclick="radioClick(2)"></form>
                <span id="2_hour">00</span> :
                <span id="2_min">00</span> :
                <span id="2_sec">00</span> :
                <span id="2_milisec">00</span>
                </td>
              <td><form><input type="radio" id="radio_3" onclick="radioClick(3)"></form>
                <span id="3_hour">00</span> :
                <span id="3_min">00</span> :
                <span id="3_sec">00</span> :
                <span id="3_milisec">00</span>
                </td>
          </tr>
          <tr>
            <td><form><input type="text" name="Translation" value="" id="3_translation"></form></td>
                <td><form><input type="text" name="Transcription" value="" id="3_transcription"></form></td>
                <td><form><input type="text" name="Notes" value="" id="3_notes"></form></td>
            <td><form><input type="radio" id="radio_4" onclick="radioClick(4)"></form>
              <span id="4_hour">00</span> :
              <span id="4_min">00</span> :
              <span id="4_sec">00</span> :
              <span id="4_milisec">00</span>
              </td>
            <td><form><input type="radio" id="radio_5" onclick="radioClick(5)"></form>
              <span id="5_hour">00</span> :
              <span id="5_min">00</span> :
              <span id="5_sec">00</span> :
              <span id="5_milisec">00</span>
              </td>
        </tr>
        </table><br>
      </div>
        
        
    </body>
</html>
